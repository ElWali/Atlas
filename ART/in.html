<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Zoomable Artwork Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Atlas CSS -->
  <link rel="stylesheet" href="https://unpkg.com/atlas@1.9.4/dist/atlas.css" />
  
  <style>
    * {margin:0; padding:0; box-sizing:border-box;}
    body {
      font-family:'Segoe UI',sans-serif;
      background:linear-gradient(135deg,#1a2a6c,#2c3e50);
      color:#fff;
      min-height:100vh;
      overflow:hidden;
    }
    .container {display:flex; flex-direction:column; height:100vh; padding:20px;}
    header {
      text-align:center;
      padding:15px 0;margin-bottom:15px;
      background:rgba(0,0,0,.4);border-radius:12px;
      box-shadow:0 4px 20px rgba(0,0,0,.3);
    }
    h1 {
      font-size:2.2rem;margin-bottom:8px;
      background:linear-gradient(to right,#ffd700,#ffa500);
      -webkit-background-clip:text;background-clip:text;color:transparent;
    }
    .subtitle {font-size:1.1rem;opacity:.9;max-width:800px;margin:0 auto;line-height:1.5;}
    .content {display:flex;flex:1;gap:20px;height:calc(100vh - 180px);}
    .map-container {
      flex:1;position:relative;border-radius:12px;overflow:hidden;
      box-shadow:0 8px 30px rgba(0,0,0,.4);background:#000;
    }
    #map {width:100%;height:100%;}
    .info-panel {
      width:300px;background:rgba(30,30,30,.85);
      border-radius:12px;padding:20px;
      box-shadow:0 4px 20px rgba(0,0,0,.3);
      overflow-y:auto;display:flex;flex-direction:column;
    }
    .info-panel h2 {
      color:#ffd700;margin-bottom:12px;
      border-bottom:1px solid rgba(255,255,255,.1);padding-bottom:8px;
    }
    .info-panel p {margin-bottom:10px;line-height:1.5;}
    .highlight {color:#ffd700;font-weight:500;}
    .controls {margin-top:auto;}
    button {
      background:linear-gradient(to bottom,#4a5568,#2d3748);
      color:white;border:none;padding:10px 15px;border-radius:6px;
      cursor:pointer;font-weight:500;transition:.3s;display:inline-flex;align-items:center;gap:6px;
    }
    button:hover {background:linear-gradient(to bottom,#5a67d8,#4c51bf);}
    .legend {
      position:absolute;bottom:15px;left:15px;
      background:rgba(30,30,30,.85);padding:12px;
      border-radius:6px;font-size:14px;z-index:9999;
      box-shadow:0 2px 6px rgba(0,0,0,.3);max-width:220px;
    }
    .legend h3 {margin-bottom:8px;color:#ffd700;font-size:1rem;}
    .legend-item {
      display:flex;align-items:center;margin-bottom:6px;
      cursor:pointer;transition:opacity .3s;
    }
    .legend-color {width:20px;height:20px;margin-right:10px;border-radius:3px;}
    .legend-item.inactive {opacity:.5;}
    .footer {text-align:center;padding:15px 0;font-size:.9rem;opacity:.8;margin-top:15px;}
    @media (max-width:900px){
      .content{flex-direction:column;height:auto;}
      .info-panel{width:100%;max-height:280px;}
      .map-container{height:60vh;}
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <h1>Zoomable Artwork Viewer</h1>
    <p class="subtitle">Cimabue Workshop ‚Äì <em>Madonna and Child Enthroned with Angels</em> (ca. 1290)</p>
  </header>

  <div class="content">
    <div class="map-container">
      <div id="map"></div>
      <div class="legend">
        <h3>Highlights (tap to toggle)</h3>
        <div class="legend-item" data-target="Mary">
          <div class="legend-color" style="background:#3388ff;"></div><div>Mary</div>
        </div>
        <div class="legend-item" data-target="Child">
          <div class="legend-color" style="background:#3388ff;"></div><div>Child</div>
        </div>
        <div class="legend-item" data-target="Angel Detail">
          <div class="legend-color" style="background:gold;"></div><div>Angel Detail</div>
        </div>
      </div>
    </div>

    <div class="info-panel">
      <h2>About</h2>
      <p>This masterpiece by the Cimabue workshop (ca. 1290) captures the transition from the **Byzantine style** with its gilded glory to the early **Renaissance** with more natural expressions.</p>
      <p>The <span class="highlight">Madonna and Child</span> sit in iconic frontal form, while their tender interaction hints at rising humanism.</p>
      <p>The angels, richly detailed, shimmer with gold leaf and intricate design.</p>
      <div class="controls">
        <button id="resetView">‚Ü©Ô∏è Reset View</button>
        <button id="startTour">‚ñ∂Ô∏è Replay Tour</button>
      </div>
    </div>
  </div>
  <div class="footer">The Met | Interactive Art Viewer</div>
</div>

<!-- Atlas -->
<script src="https://unpkg.com/atlas@1.9.4/dist/atlas.js"></script>
<script src="https://unpkg.com/atlas-iiif@2.0.0/atlas-iiif.js"></script>
<script>
const map = A.map('map',{
  center:[0,0], crs:A.CRS.Simple, zoom:0, minZoom:-2, maxZoom:8, zoomControl:true
});

const iiifUrl='https://images.metmuseum.org/CRDImages/ep/original/DP-18379-001/info.json';
const iiifLayer=A.tileLayer.iiif(iiifUrl,{fitBounds:false}).addTo(map);
iiifLayer.on('load',()=>map.fitBounds(iiifLayer.getBounds()));

// === Annotations ===
const overlays = {
  "Mary": A.marker([1500,3000]).addTo(map)
    .bindPopup("<b>Virgin Mary</b><br/>Halo, gilding, and delicate grace.")
    .bindTooltip("üëë Mary"),
  "Child": A.marker([1550,3600]).addTo(map)
    .bindPopup("<b>Christ Child</b><br/>Tender natural folds.")
    .bindTooltip("‚ú® Child"),
  "Angel Detail": A.polygon([[600,4200],[600,4600],[1100,4600],[1100,4200]],{
      color:'gold',weight:2,fillOpacity:0.25
    }).addTo(map)
    .bindPopup("<b>Angel Detail</b><br/>Shimmering feathers & intricate patterns.")
};

// Toggle overlays via legend
document.querySelectorAll('.legend-item').forEach(item=>{
  const key=item.dataset.target;
  const layer=overlays[key];
  item.onclick=()=>{
    if(map.hasLayer(layer)){
      map.removeLayer(layer);
      item.classList.add('inactive');
    } else {
      map.addLayer(layer);
      item.classList.remove('inactive');
    }
  };
});

// Reset button
document.getElementById('resetView').onclick=()=>map.fitBounds(iiifLayer.getBounds());

// Guided Tour (sequential fly)
function guidedTour(stops=[...Object.values(overlays)], delay=3000){
  let i=0;
  function step(){
    const l=stops[i];
    if('getLatLng' in l){
      map.flyTo(l.getLatLng(),5);
    } else {
      map.flyToBounds(l.getBounds(),{maxZoom:5});
    }
    if(l.openPopup) l.openPopup();
    i++;
    if(i<stops.length) setTimeout(step,delay);
  }
  step();
}
document.getElementById('startTour').onclick=()=>guidedTour();
</script>
</body>
</html>
